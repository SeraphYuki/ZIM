#ifndef LIBRARY_COMPILE


#ifdef WINDOWS_COMPILE
#define GLEW_STATIC
#endif
#include <GL/glew.h>
#include <SDL2/SDL.h>
#include <SDL2/SDL_opengl.h>
#include "window.h"
#include "types.h"
#include <stdio.h>
#include "log.h"

static SDL_Window *window;
static SDL_GLContext context;

int Window_Open(){

    SDL_GL_SetAttribute(SDL_GL_DOUBLEBUFFER, 1);
    SDL_GL_SetAttribute(SDL_GL_CONTEXT_MAJOR_VERSION, 3);
    SDL_GL_SetAttribute(SDL_GL_CONTEXT_MINOR_VERSION, 0);

    window = SDL_CreateWindow(
        WINDOW_TITLE,
        10,
        39,
        WINDOW_INIT_WIDTH,
        WINDOW_INIT_HEIGHT,
        SDL_WINDOW_OPENGL | SDL_WINDOW_RESIZABLE
    );


    int pixels[] = {
0x00000000 ,0x00000000 ,0x01000000 ,0x550a2a00 ,0xf0c1a300 ,0x3e46301b ,0x5f6a4930 ,0x697c5239 ,0x6c2d3b48 ,0xb3205c9c ,0xc7306ce9 ,0xb21554f2 ,0x6d0c327e ,0x10170e09 ,0x00000000 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x00000002 ,0x52102b28 ,0x67634b5c ,0x97ad75cf ,0xa7bd81e8 ,0xa09d74ed ,0xbd5072f3 ,0xf081a4ff ,0xf18ca9ff ,0xc53266ff ,0x893a4af3 ,0x485d385f ,0x0b170700 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x0300010c ,0x9d1f52bb ,0xbe466ef8 ,0xa77469ff ,0xa3b97bff ,0xae6068ff ,0xea6193ff ,0xea81a0ff ,0xce4b76ff ,0xb42154ff ,0x91745dff ,0x52753ebb ,0x0308020b ,0x00000000 ,
0x00000000 ,0x00000000 ,0x03010106 ,0x6e3340ab ,0x9b5061fe ,0x966367ff ,0xa2ac84ff ,0xb24e6cff ,0xdb1166ff ,0xcc316aff ,0xbb3564ff ,0x8a464dff ,0x709450ff ,0x436d30f0 ,0x0f190b33 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x00000000 ,0x454d4230 ,0x696c645e ,0x444240aa ,0x3f3a3bfa ,0x463039ff ,0x610d31ff ,0x632038ff ,0x593945ff ,0x435834ff ,0x447330f1 ,0x28431c9a ,0x05080334 ,0x00000000 ,
0x00000002 ,0x00000005 ,0x00000000 ,0x55504c00 ,0x1b000712 ,0x37022087 ,0x0b0006c0 ,0x15020bfd ,0x17050dff ,0x000000ff ,0x172811ff ,0x396029e5 ,0x243b1a61 ,0x0000000d ,0x00000028 ,0x00000000 ,
0x00000032 ,0x00000084 ,0x00000013 ,0x00000000 ,0x1f04133d ,0x3c06254e ,0x430728a4 ,0x210413e7 ,0x19030dff ,0x0e170aff ,0x365a27cc ,0x22381850 ,0x0000000a ,0x00000014 ,0x0000001c ,0x00000000 ,
0x0000000d ,0x00000044 ,0x0000004a ,0x0000002f ,0x0200011c ,0x0c150f09 ,0x41243333 ,0x0601049c ,0x190a0eff ,0x273e1bd0 ,0x32532431 ,0xffffff00 ,0x0a060600 ,0x00000006 ,0x00000015 ,0x0000005f ,
0x00000000 ,0x00000000 ,0x00000017 ,0x0000005a ,0x1c111253 ,0x3f2e2d4b ,0x7a77689b ,0x5e5e50d1 ,0x2c2a1de7 ,0x223a1841 ,0x97005f01 ,0x4f31340e ,0x08050530 ,0x0000003d ,0x0000003b ,0x00000050 ,
0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x3d26280d ,0x5a383c39 ,0x674c4787 ,0x8a695df1 ,0x73544ee6 ,0x67414669 ,0x6a41463d ,0x5d393d33 ,0x100a0a3a ,0x0000001e ,0x00000005 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x00000000 ,0x05010300 ,0x5e112b00 ,0x1300050c ,0x8a113c85 ,0x9b274df8 ,0x845d68ff ,0x75595ea3 ,0x5d393d0a ,0x2e2d2100 ,0x0b070800 ,0x00000000 ,0x00000000 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x00000000 ,0x56082400 ,0x5e092729 ,0xa30e44aa ,0xcf1056fb ,0xaa134dfd ,0x775561c0 ,0x6e50553a ,0x6e434800 ,0x140c0d00 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x00000000 ,0x42061c49 ,0x9f0d43c9 ,0xd51259ea ,0xd51059ef ,0xa70946f5 ,0x52082546 ,0x8a6d7400 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,
0x00000000 ,0x00000000 ,0x00000028 ,0x10010788 ,0x5707254a ,0xa40e4528 ,0x92093d34 ,0x3c0319a1 ,0x1f010d4d ,0x01010100 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,
0x00000001 ,0x00000010 ,0x00000065 ,0x0000001e ,0x710a2f00 ,0xa00d4300 ,0x9f0a4300 ,0x00000021 ,0x0000005f ,0x00000005 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,
0x0000001a ,0x00000044 ,0x00000023 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000001 ,0x00000051 ,0x00000029 ,0x00000001 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,0x00000000 ,
};

    SDL_Surface *surface = SDL_CreateRGBSurfaceFrom(pixels,16,16,24,16*4,0xff000000,0x00ff0000,0x0000ff00,0x000000ff);

    SDL_SetWindowIcon(window, surface);

    SDL_FreeSurface(surface);
    
    context = SDL_GL_CreateContext(window);
    SDL_GL_SetSwapInterval(1);

    context = SDL_GL_CreateContext(window);
    SDL_GL_SetSwapInterval(1);

    glewExperimental = GL_TRUE;

    if(glewInit() != GLEW_OK) {
        LOG(LOG_RED, "Glew Init Failed\n");
        return 0;
    }

    glDisable(GL_DITHER);
    glDisable(GL_DEPTH_TEST);
    // glEnable(GL_STENCIL_TEST);
    // glStencilOp(GL_REPLACE, GL_KEEP, GL_KEEP);
    glEnable(GL_CULL_FACE);
    glDisable(GL_LINE_SMOOTH);
    glCullFace(GL_BACK);
    glDisable(GL_BLEND);


    
    return 1;
}

void Window_Close(){
    SDL_GL_DeleteContext(context);
    SDL_DestroyWindow(window);
    SDL_Quit();
}

int Window_GetTicks(){
    return SDL_GetTicks();
}

void Window_Swap(){

    SDL_GL_SwapWindow(window);
}

void Window_PollEvent(void (*callback)(SDL_Event ev)){

    SDL_Event ev;

    while(SDL_PollEvent(&ev))
        callback(ev);
}

#endif